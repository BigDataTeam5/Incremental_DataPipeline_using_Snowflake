name: Test Secrets Deployment

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    env:
      SNOWFLAKE_ACCOUNT: ${{ secrets.SNOWFLAKE_ACCOUNT }}
      SNOWFLAKE_USER: ${{ secrets.SNOWFLAKE_USER }}
      SNOWFLAKE_PASSWORD: ${{ secrets.SNOWFLAKE_PASSWORD }}
      AWS_ACCESS_KEY: ${{ secrets.AWS_ACCESS_KEY }}
      AWS_SECRET_KEY: ${{ secrets.AWS_SECRET_KEY }}
      AWS_REGION: ${{ secrets.AWS_REGION }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Print Environment Variables (masked)
        run: |
          echo "AWS_ACCESS_KEY: ${AWS_ACCESS_KEY:0:5}..."
          echo "AWS_SECRET_KEY: ${AWS_SECRET_KEY:0:5}..."
          echo "AWS_REGION: ${AWS_REGION}"
          echo "SNOWFLAKE_ACCOUNT: ${SNOWFLAKE_ACCOUNT:0:5}..."
          echo "SNOWFLAKE_USER: ${SNOWFLAKE_USER}"

      - name: Test Snowflake Connection
        run: |
          python -m pip install --upgrade pip
          pip install snowflake-connector-python
          python -c "import snowflake.connector; 
try:
    conn = snowflake.connector.connect(
        user='${SNOWFLAKE_USER}',
        password='${SNOWFLAKE_PASSWORD}',
        account='${SNOWFLAKE_ACCOUNT}'
    )
    print('Snowflake connection successful!')
    conn.close()
except Exception as e:
    print('Snowflake connection failed:', e)"
